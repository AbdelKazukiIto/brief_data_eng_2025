# Dockerfile pour builder et lancer une application FastAPI
# Placez ce fichier dans le même répertoire que requirements.txt et votre application (ex: main.py avec `app` FastAPI)
FROM python:3.11-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# Dépendances système nécessaires pour compiler certaines wheels (adapter si inutile)
RUN apt-get update \
 && apt-get install -y --no-install-recommends build-essential gcc libpq-dev \
 && rm -rf /var/lib/apt/lists/*

# Copier le fichier de dépendances en premier pour profiter du cache Docker
COPY requirements.txt ./

# Installer pip / dépendances
RUN pip install --upgrade pip setuptools wheel \
 && pip install --no-cache-dir -r requirements.txt

# Copier le reste de l'application
COPY . .

# Créer un utilisateur non-root et donner la propriété des fichiers
RUN useradd -m appuser \
 && chown -R appuser:appuser /app

USER appuser

EXPOSE 8001

# Commande par défaut : adapte "main:app" si ton point d'entrée est différent (ex: app.main:app)
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8001"]